# Тестирование REST API расчёта стоимости продукта

## Объект для тестирования
REST API метод расчёта стоимости продукта:

GET /products/{productId}/cost?authToken=&count=&start=

Метод предназначен для вычисления стоимости продукта на основе количества приобретаемых экземпляров и количества ранее приобретённых экземпляров.


## Цель тестирования
Целью тестирования является проверка корректности работы REST API, включая:
- корректность бизнес-логики расчёта стоимости продукта
- корректность обработки входных параметров
- корректность авторизации по authToken
- корректность возвращаемых HTTP-кодов
- корректность формата тела ответов, включая сообщения об ошибках


## Сроки проведения тестирования
Тестирование проводится в рамках текущего спринта разработки после завершения реализации метода и до передачи функциональности на приёмочное тестирование.


## Команда тестирования
- Тестировщик: 1 человек
- Системный аналитик: 1 человек
- Разработчик: 1 человек


## Области, подвергаемые тестированию
- REST API метод /products/{productId}/cost
- Авторизация по параметру authToken
- Обработка параметра productId
- Обработка параметров count и start
- Расчёт стоимости продукта:
    - расчёт нарастающим итогом
    - расчёт с учётом параметра start
    - расчёт партиями по 5 экземпляров
- Формат успешного ответа JSON
- Формат сообщений об ошибках
- Возвращаемые HTTP-коды (200, 401, 404, 500)


## 6. Области, не подвергаемые тестированию
- Пользовательский интерфейс
- Процесс оплаты и оформления заказа
- Производительность и нагрузочное тестирование
- Безопасность на уровне инфраструктуры
- Хранение и обработка токенов авторизации вне данного метода

## 7. Подходы к тестированию
В ходе тестирования используются следующие подходы:
- функциональное тестирование
- негативное тестирование
- тестирование граничных значений
- контрактное тестирование REST API

Проверки выполняются путём отправки HTTP-запросов с различными комбинациями входных параметров и анализа ответов сервиса

## 8. Критерии начала тестирования
Тестирование может быть начато при выполнении следующих условий:
- REST API метод развернут на тестовом окружении
- доступен валидный authToken
- в системе присутствует как минимум один существующий productId
- известны правила расчёта стоимости продукта


## 9. Критерии приостановки тестирования
Тестирование приостанавливается в случае:
- недоступности тестового окружения
- отсутствия валидного authToken
- критических дефектов, блокирующих выполнение большинства проверок


## 10. Критерии возобновления тестирования
Тестирование возобновляется после:
- восстановления работоспособности тестового окружения
- предоставления валидных тестовых данны
- исправления блокирующих дефектов


## 11. Критерии завершения тестирования
Тестирование считается завершённым, если:
- выполнены позитивные, негативные и пограничные проверки по всем параметрам
- подтверждена корректность расчёта стоимости продукта с указанием точных ожидаемых значений
- подтверждены корректные HTTP-коды ответов
- подтверждён формат сообщений об ошибках:
    - для HTTP 500 тело ответа содержит JSON с обязательным полем errorMessage


## Расписание
- Подготовка тестового плана: 5 часов
- Проведение тестирования: 4 часа
- Анализ результатов и оформление дефектов: 3 часа


## Оценка рисков
- Возможна неоднозначная трактовка правила партиями по 5 экземпляров
- Отсутствие явной спецификации поведения при невалидных параметрах (count, start)
- Возможность возврата HTTP 500 вместо ожидаемых клиентских ошибок


## Документация
В ходе тестирования используются следующие документы\\:
- описание REST API метода
- таблица стоимости продукта
- данный тест-план
- отчёты о выполнении тестирования и найденных дефектах


## Тест-кейсы

### 1. Авторизация

**Тест-кейс 1: Расчёт стоимости при валидном authToken и существующем продукте**

Предусловия:
- Пользователь имеет действующий authToken
- Существует валидный productId

Шаги:
- Передать валидный authToken
- Передать count=5
- Передать start=0
- Отправить GET-запрос  
  /products/{productId}/cost?authToken=VALID_TOKEN&count=5&start=0

Ожидаемый результат:
- HTTP-код ответа: 200
- Ответ в формате JSON
- Тело ответа:{ "cost": 100 }

Постусловия:

**Тест-кейс 2: Запрос без передачи authToken**

Предусловия:
- Существует валидный productId

Шаги:
- Не передавать параметр authToken
- Отправить GET-запрос  
  `/products/{productId}/cost?count=5&start=0`

Ожидаемый результат:
- HTTP-код ответа: 401

Постусловия:


**Тест-кейс 3: Запрос с authToken неверной длины**

Предусловия:
- Существует валидный productId

Шаги:
- Передать authToken=ABC123
- Отправить GET-запрос  
  /products/{productId}/cost?authToken=ABC123&count=5&start=0`

Ожидаемый результат:
- HTTP-код ответа: 401

Постусловия:


### 2. productId

**Тест-кейс 4: Запрос стоимости несуществующего продукта**

Предусловия:
- Пользователь имеет валидный authToken
- productId отсутствует в системе

Шаги:
- Передать валидный authToken
- Передать несуществующий productId
- Отправить GET-запрос  
  /products/{productId}/cost?authToken=VALID_TOKEN&count=5&start=0

Ожидаемый результат:
- HTTP-код ответа: 404

Постусловия:


### 3. Расчёт стоимости

**Тест-кейс 5: Расчёт стоимости при start=0 и count=5**

Предусловия:
- Пользователь авторизован
- Существует валидный productId

Шаги:
- Передать count=5
- Передать start=0
- Отправить GET-запрос  
  `/products/{productId}/cost?authToken=VALID_TOKEN&count=5&start=0`

Ожидаемый результат:
- HTTP-код ответа: 200
- Тело ответа: { "cost": 100 }

Постусловия:


**Тест-кейс 6: Расчёт стоимости при start=2 и count=2**

Предусловия:
- Пользователь авторизован
- Существует валидный productId

Шаги:
- Передать start=2
- Передать count=2
- Отправить GET-запрос  
  `/products/{productId}/cost?authToken=VALID_TOKEN&count=2&start=2`

Ожидаемый результат:
- HTTP-код ответа: 200
- Тело ответа: { "cost": 35 }

Постусловия:


**Тест-кейс 7: Расчёт стоимости при count > 5**

Предусловия:
- Пользователь авторизован
- Существует валидный productId

Шаги:
- Передать count=6
- Передать start=0
- Отправить GET-запрос  
  /products/{productId}/cost?authToken=VALID_TOKEN&count=6&start=0

Ожидаемый результат:
- HTTP-код ответа: 200
- Тело ответа: { "cost": 130 }

Постусловия:


### 4. Невалидные значения параметров

**Тест-кейс 8: Передача count=0**

Предусловия:
- Пользователь авторизован
- Существует валидный productId

Шаги:
- Передать count=0
- Отправить GET-запрос  
  `/products/{productId}/cost?authToken=VALID_TOKEN&count=0&start=0`

Ожидаемый результат:
- HTTP-код ответа: 500
- Ответ в формате JSON
- Тело ответа: { "errorMessage": "<непустая строка>" }
- Поле errorMessage присутствует и не пустое\
Постусловия:


**Тест-кейс 9: Передача отрицательного значения start**

Предусловия:
- Пользователь авторизован
- Существует валидный productId

Шаги:
- Передать start=-1
- Отправить GET-запрос  
  /products/{productId}/cost?authToken=VALID_TOKEN&count=1&start=-1

Ожидаемый результат:
- HTTP-код ответа: 500
- Ответ в формате JSON
- Тело ответа: { "errorMessage": "<непустая строка>" }
- Поле errorMessage присутствует и не пустое

Постусловия:


### 5. Проверка безопасности

**Тест-кейс 10: Попытка SQL-инъекции через productId**

Предусловия:
- Пользователь авторизован

Шаги:
- В productId указать 1 OR 1=1
- Передать валидный authToken
- Отправить GET-запрос  
  `/products/1 OR 1=1/cost?authToken=VALID_TOKEN&count=1&start=0`

Ожидаемый результат:
- Ошибка сервера 500 отсутствует
- HTTP-код ответа: 400 или 404

Постусловия:
