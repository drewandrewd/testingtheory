# Тестирование взаимодействия сервисов A и B через RabbitMQ

## Объект для тестирования
Интеграция двух сервисов:

- Сервис A принимает REST запросы на изменение состояния услуги 
- Сервис A отправляет ampq команду в Сервис B через RabbitMQ
- Сервис B выполняет операцию и отправляет amqp сообщение с результатом обратно в Сервис A
- Сервис A обеспечивает упорядочивание команд и не отправляет следующую, пока не получит ответ на предыдущую
- Статус услуги в сервисе A меняется только после положительного ответа от сервиса B
- REST запросы в сервис A принимаются независимо от результата взаимодействия с сервисом B


## Цель тестирования
Проверить корректность работы интеграции, включая:
- приём REST-запросов сервисом A
- отправку AMQP-команд в сервис B и получение AMQP ответов
- соблюдение очередности команд
- изменение статуса услуги только после успешного ответа B
- базовую обработку ошибок/недоступности B или RabbitMQ

## Сроки проведения тестирования
Тестирование проводится в рамках текущего спринта: 25.12 - 26.12.2025


## Команда тестирования
- Тестировщик: 1 человек
- Системный аналитик: 1 человек


## Области, подвергаемые тестированию
- REST API сервиса A
- Отправка amqp сообщение от A сервиса в сервис B
- Получение amqp сообщение от B сервис в сервис A
- Очередность команд
- Изменение статуса услуги в A:
    - статус меняется только после успешного ответа от B
- Поведение при ошибках:
    - отрицательный ответ от B
    - отсутствие ответа
    - недоступность RabbitMQ

## Области, не подвергаемые тестированию
- Пользовательский интерфейс
- Внутренняя реализация бизнес-операций в сервисе B
- Производительность и нагрузочное тестирование
- Безопасность на уровне инфраструктуры и сетей
- Детальная проверка формата AMQP сообщений


## Подходы к тестированию
- интеграционное тестирование
- функциональное тестирование основных сценариев
- негативное тестирование

Проверки выполняются путём отправки REST запросов в сервис A и наблюдения:
- факта отправки команд в RabbitMQ
- факта получения ответов от B
- изменения статуса услуги в A


## Критерии начала тестирования
Тестирование может быть начато при выполнении следующих условий:
- сервис A развернут на тестовом окружении
- сервис B развернут на тестовом окружении
- RabbitMQ доступен
- есть тестовая услуга (serviceId) для проверки изменения статуса


## Критерии приостановки тестирования
Тестирование приостанавливается в случае:
- недоступности тестового окружения
- недоступности RabbitMQ
- критических дефектов, блокирующих выполнение большинства проверок


## Критерии возобновления тестирования
Тестирование возобновляется после:
- восстановления окружения и RabbitMQ
- предоставления валидных тестовых данны
- исправления блокирующих и критичных дефектов


## Критерии завершения тестирования
Функционал протестирован, если:
- пройдены все тестовые случаи
- дефекты выявлены и задокументированы
- команды отправляются строго последовательно
- зафиксировано ожидаемое поведение при ошибках/недоступности
- проведено ревью и анализ результатов тестирования


## Расписание
- Подготовка тестового плана: 25.12.2025 (5 часов)
- Проведение тестирования: 26.12.2025 (4 часа)
- Анализ результатов и оформление дефектов: 26.12.2025 (3 часа)


## Оценка рисков
- Нарушение порядка команд при нескольких запросах подряд
- Потеря сообщений и некорректная обработка ответов
- Долгое ожидание ответа от B и «застревание» очереди команд
- Проблемы доступности RabbitMQ/сервиса B
- Уход члена команды в отпуск или на больничный

## Документация
В ходе тестирования используются следующие документы:
- описание REST-операций сервиса A
- описание интеграции
- данный тест-план
- отчёты о выполнении тестирования и найденных дефектах

## Тест-кейсы (верхнеуровнево)

### 1. Основные сценарии
**Тест-кейс 1: Подключение услуги (успешный сценарий)**
- REST запрос в A на подключение
- Проверка, что A отправил команду в B и получил валидный ответ
- Проверка, что статус услуги в A изменён после ответа

**Тест-кейс 2: Отключение услуги (успешный сценарий)**
- REST-запрос в A на отключение
- Команда ушла в B, получен валидный ответ
- Статус услуги изменён после ответа

**Тест-кейс 3: Блокировка услуги (успешный сценарий)**
- REST-запрос в A на блокировку
- Команда ушла в B, получен валидный ответ
- Статус услуги изменён после ответа

### 2. Очередность команд
**Тест-кейс 4: Два запроса подряд выполняются последовательно**
- Отправить два REST-запроса подряд (например, connect затем disconnect)
- Проверить, что A отправил вторую AMQP команду только после ответа на первую
- Итоговый статус соответствует последней успешной операции

**Тест-кейс 5: Несколько запросов подряд выполняются в порядке поступления**
- Отправить 3 REST-запросов подряд
- Проверить, что команды выполняются последовательно и в порядке поступления

### 3. Ошибки и недоступность
**Тест-кейс 6: Сервис B возвращает отрицательный результат**
- REST-запрос в A на изменение состояния
- B отвечает fail
- Проверить, что статус услуги в A не изменён на целевой

**Тест-кейс 7: Ответ от B не получен (таймаут/недоступность)**
- Отправить REST запрос в A
- Не получить ответ от B в разумный срок
- Проверить, что статус услуги не изменён

**Тест-кейс 8: RabbitMQ недоступен**
- RabbitMQ выключен/недоступен
- Отправить REST-запрос в A
- Проверить, что команда не доставлена и статус услуги не изменён
